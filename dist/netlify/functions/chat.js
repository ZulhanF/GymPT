const{GoogleGenerativeAI}=require("@google/generative-ai");exports.handler=async(e,s)=>{const t={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type","Access-Control-Allow-Methods":"POST, OPTIONS"};if("OPTIONS"===e.httpMethod)return{statusCode:200,headers:t,body:""};try{console.log("Function triggered with event:",JSON.stringify(e,null,2));const{message:s}=JSON.parse(e.body);if(!s)return{statusCode:400,headers:t,body:JSON.stringify({error:"Message is required"})};if(console.log("Processing message:",s),s.toLowerCase().includes("test"))return{statusCode:200,headers:t,body:JSON.stringify({text:"Test successful! Netlify Functions are working. Your message was: "+s})};const o=new GoogleGenerativeAI("AIzaSyAOaM4w4LCzGELsLO4Vh4nXIs0HhoEQMLw"),r={temperature:.2,topK:1,topP:.8},n=o.getGenerativeModel({model:"gemini-2.0-flash",generationConfig:r}).startChat({history:[],generationConfig:r,systemInstruction:{role:"system",parts:[{text:"You are a professional fitness assistant. ONLY answer questions related to fitness, workouts, nutrition, and health. For ANY questions outside of these topics, respond ONLY with: 'Aku hanya bisa menjawab pertanyaan terkait GYM dan WORKOUT ya teman-teman.'"}]}}),a=(await n.sendMessage(s)).response.text();return console.log("AI Response:",a),{statusCode:200,headers:t,body:JSON.stringify({text:a})}}catch(e){return console.error("Error in function:",e),{statusCode:500,headers:t,body:JSON.stringify({error:"Failed to process your request",details:e.message})}}};